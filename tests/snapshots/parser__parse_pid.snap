---
source: tests/parser.rs
expression: file
---
typedefs:
  - id: GainPID
    kind:
      Structure:
        fields:
          - - k_p
            - Float
          - - k_i
            - Float
          - - k_d
            - Float
    location: ~
functions:
  - id: min
    inputs:
      - - a
        - Float
      - - b
        - Float
    statements:
      - id: test
        element_type: Boolean
        expression:
          kind:
            Application:
              function_expression:
                kind:
                  Identifier:
                    id: " > "
                location: ~
              inputs:
                - kind:
                    Identifier:
                      id: a
                  location: ~
                - kind:
                    Identifier:
                      id: b
                  location: ~
          location: ~
        location: ~
      - id: result
        element_type: Float
        expression:
          kind:
            Application:
              function_expression:
                kind:
                  Identifier:
                    id: if_then_else
                location: ~
              inputs:
                - kind:
                    Identifier:
                      id: test
                  location: ~
                - kind:
                    Identifier:
                      id: b
                  location: ~
                - kind:
                    Identifier:
                      id: a
                  location: ~
          location: ~
        location: ~
    returned:
      - Float
      - kind:
          Identifier:
            id: result
        location: ~
    location: ~
nodes:
  - id: integrate
    is_component: false
    inputs:
      - - x
        - Float
      - - dt
        - Float
    equations:
      - - prev_i
        - scope: Local
          id: prev_i
          signal_type: Float
          expression:
            kind:
              FollowedBy:
                constant:
                  kind:
                    Expression:
                      expression:
                        Constant:
                          constant:
                            Float: 0
                  location: ~
                expression:
                  kind:
                    Expression:
                      expression:
                        Identifier:
                          id: i
                  location: ~
            location: ~
          location: ~
      - - i
        - scope: Output
          id: i
          signal_type: Float
          expression:
            kind:
              Expression:
                expression:
                  Application:
                    function_expression:
                      kind:
                        Expression:
                          expression:
                            Identifier:
                              id: min
                      location: ~
                    inputs:
                      - kind:
                          Expression:
                            expression:
                              Application:
                                function_expression:
                                  kind:
                                    Expression:
                                      expression:
                                        Identifier:
                                          id: " + "
                                  location: ~
                                inputs:
                                  - kind:
                                      Expression:
                                        expression:
                                          Identifier:
                                            id: prev_i
                                    location: ~
                                  - kind:
                                      Expression:
                                        expression:
                                          Application:
                                            function_expression:
                                              kind:
                                                Expression:
                                                  expression:
                                                    Identifier:
                                                      id: " * "
                                              location: ~
                                            inputs:
                                              - kind:
                                                  Expression:
                                                    expression:
                                                      Identifier:
                                                        id: x
                                                location: ~
                                              - kind:
                                                  Expression:
                                                    expression:
                                                      Identifier:
                                                        id: dt
                                                location: ~
                                    location: ~
                        location: ~
                      - kind:
                          Expression:
                            expression:
                              Identifier:
                                id: MAX_INTEGRALE
                        location: ~
            location: ~
          location: ~
      - - MAX_INTEGRALE
        - scope: Local
          id: MAX_INTEGRALE
          signal_type: Float
          expression:
            kind:
              Expression:
                expression:
                  Constant:
                    constant:
                      Float: 1000
            location: ~
          location: ~
    contract:
      requires: []
      ensures: []
      invariant: []
    location: ~
  - id: derive
    is_component: false
    inputs:
      - - x
        - Float
      - - dt
        - Float
    equations:
      - - d
        - scope: Output
          id: d
          signal_type: Float
          expression:
            kind:
              Expression:
                expression:
                  Application:
                    function_expression:
                      kind:
                        Expression:
                          expression:
                            Identifier:
                              id: " / "
                      location: ~
                    inputs:
                      - kind:
                          Expression:
                            expression:
                              Application:
                                function_expression:
                                  kind:
                                    Expression:
                                      expression:
                                        Identifier:
                                          id: (_)
                                  location: ~
                                inputs:
                                  - kind:
                                      Expression:
                                        expression:
                                          Application:
                                            function_expression:
                                              kind:
                                                Expression:
                                                  expression:
                                                    Identifier:
                                                      id: " - "
                                              location: ~
                                            inputs:
                                              - kind:
                                                  Expression:
                                                    expression:
                                                      Identifier:
                                                        id: x
                                                location: ~
                                              - kind:
                                                  Expression:
                                                    expression:
                                                      Identifier:
                                                        id: prev_x
                                                location: ~
                                    location: ~
                        location: ~
                      - kind:
                          Expression:
                            expression:
                              Identifier:
                                id: dt
                        location: ~
            location: ~
          location: ~
      - - prev_x
        - scope: Local
          id: prev_x
          signal_type: Float
          expression:
            kind:
              FollowedBy:
                constant:
                  kind:
                    Expression:
                      expression:
                        Constant:
                          constant:
                            Float: 0
                  location: ~
                expression:
                  kind:
                    Expression:
                      expression:
                        Identifier:
                          id: x
                  location: ~
            location: ~
          location: ~
    contract:
      requires: []
      ensures: []
      invariant: []
    location: ~
component:
  id: pid
  is_component: true
  inputs:
    - - v_c
      - Float
    - - v
      - Float
    - - dt
      - Float
  equations:
    - - gain
      - scope: Local
        id: gain
        signal_type:
          NotDefinedYet: GainPID
        expression:
          kind:
            Expression:
              expression:
                Structure:
                  name: GainPID
                  fields:
                    - - k_p
                      - kind:
                          Expression:
                            expression:
                              Constant:
                                constant:
                                  Float: 0.2
                        location: ~
                    - - k_i
                      - kind:
                          Expression:
                            expression:
                              Constant:
                                constant:
                                  Float: 1.5
                        location: ~
                    - - k_d
                      - kind:
                          Expression:
                            expression:
                              Constant:
                                constant:
                                  Float: 6
                        location: ~
          location: ~
        location: ~
    - - u
      - scope: Output
        id: u
        signal_type: Float
        expression:
          kind:
            Expression:
              expression:
                Match:
                  expression:
                    kind:
                      Expression:
                        expression:
                          Application:
                            function_expression:
                              kind:
                                Expression:
                                  expression:
                                    Identifier:
                                      id: (_)
                              location: ~
                            inputs:
                              - kind:
                                  Expression:
                                    expression:
                                      Identifier:
                                        id: gain
                                location: ~
                    location: ~
                  arms:
                    - - kind:
                          Structure:
                            name: GainPID
                            fields:
                              - - k_p
                                - kind:
                                    Identifier:
                                      name: k_p
                                  location: ~
                              - - k_i
                                - kind:
                                    Identifier:
                                      name: k_i
                                  location: ~
                              - - k_d
                                - kind:
                                    Identifier:
                                      name: k_d
                                  location: ~
                        location: ~
                      - ~
                      - kind:
                          Expression:
                            expression:
                              Application:
                                function_expression:
                                  kind:
                                    Expression:
                                      expression:
                                        Identifier:
                                          id: " + "
                                  location: ~
                                inputs:
                                  - kind:
                                      Expression:
                                        expression:
                                          Application:
                                            function_expression:
                                              kind:
                                                Expression:
                                                  expression:
                                                    Identifier:
                                                      id: " + "
                                              location: ~
                                            inputs:
                                              - kind:
                                                  Expression:
                                                    expression:
                                                      Application:
                                                        function_expression:
                                                          kind:
                                                            Expression:
                                                              expression:
                                                                Identifier:
                                                                  id: " * "
                                                          location: ~
                                                        inputs:
                                                          - kind:
                                                              Expression:
                                                                expression:
                                                                  Identifier:
                                                                    id: k_p
                                                            location: ~
                                                          - kind:
                                                              Expression:
                                                                expression:
                                                                  Identifier:
                                                                    id: e
                                                            location: ~
                                                location: ~
                                              - kind:
                                                  Expression:
                                                    expression:
                                                      Application:
                                                        function_expression:
                                                          kind:
                                                            Expression:
                                                              expression:
                                                                Identifier:
                                                                  id: " * "
                                                          location: ~
                                                        inputs:
                                                          - kind:
                                                              Expression:
                                                                expression:
                                                                  Identifier:
                                                                    id: k_i
                                                            location: ~
                                                          - kind:
                                                              Expression:
                                                                expression:
                                                                  Identifier:
                                                                    id: e_i
                                                            location: ~
                                                location: ~
                                    location: ~
                                  - kind:
                                      Expression:
                                        expression:
                                          Application:
                                            function_expression:
                                              kind:
                                                Expression:
                                                  expression:
                                                    Identifier:
                                                      id: " * "
                                              location: ~
                                            inputs:
                                              - kind:
                                                  Expression:
                                                    expression:
                                                      Identifier:
                                                        id: k_d
                                                location: ~
                                              - kind:
                                                  Expression:
                                                    expression:
                                                      Identifier:
                                                        id: e_d
                                                location: ~
                                    location: ~
                        location: ~
          location: ~
        location: ~
    - - e
      - scope: Local
        id: e
        signal_type: Float
        expression:
          kind:
            Expression:
              expression:
                Application:
                  function_expression:
                    kind:
                      Expression:
                        expression:
                          Identifier:
                            id: " - "
                    location: ~
                  inputs:
                    - kind:
                        Expression:
                          expression:
                            Identifier:
                              id: v_c
                      location: ~
                    - kind:
                        Expression:
                          expression:
                            Identifier:
                              id: v
                      location: ~
          location: ~
        location: ~
    - - e_i
      - scope: Local
        id: e_i
        signal_type: Float
        expression:
          kind:
            Expression:
              expression:
                FieldAccess:
                  expression:
                    kind:
                      Expression:
                        expression:
                          Application:
                            function_expression:
                              kind:
                                Expression:
                                  expression:
                                    Identifier:
                                      id: integrate
                              location: ~
                            inputs:
                              - kind:
                                  Expression:
                                    expression:
                                      Identifier:
                                        id: e
                                location: ~
                              - kind:
                                  Expression:
                                    expression:
                                      Identifier:
                                        id: dt
                                location: ~
                    location: ~
                  field: i
          location: ~
        location: ~
    - - e_d
      - scope: Local
        id: e_d
        signal_type: Float
        expression:
          kind:
            Expression:
              expression:
                FieldAccess:
                  expression:
                    kind:
                      Expression:
                        expression:
                          Application:
                            function_expression:
                              kind:
                                Expression:
                                  expression:
                                    Identifier:
                                      id: derive
                              location: ~
                            inputs:
                              - kind:
                                  Expression:
                                    expression:
                                      Identifier:
                                        id: e
                                location: ~
                              - kind:
                                  Expression:
                                    expression:
                                      Identifier:
                                        id: dt
                                location: ~
                    location: ~
                  field: d
          location: ~
        location: ~
  contract:
    requires: []
    ensures: []
    invariant: []
  location: ~
location: ~
