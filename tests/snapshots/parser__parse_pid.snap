---
source: tests/parser.rs
expression: file
---
typedefs:
  - Structure:
      id: GainPID
      fields:
        - - k_p
          - Float
        - - k_i
          - Float
        - - k_d
          - Float
      location: ~
functions:
  - id: min
    inputs:
      - - a
        - Float
      - - b
        - Float
    statements:
      - id: test
        element_type: Boolean
        expression:
          Application:
            function_expression:
              Call:
                id: " > "
                typing: ~
                location: ~
            inputs:
              - Call:
                  id: a
                  typing: ~
                  location: ~
              - Call:
                  id: b
                  typing: ~
                  location: ~
            typing: ~
            location: ~
        location: ~
      - id: result
        element_type: Float
        expression:
          Application:
            function_expression:
              Call:
                id: if_then_else
                typing: ~
                location: ~
            inputs:
              - Call:
                  id: test
                  typing: ~
                  location: ~
              - Call:
                  id: b
                  typing: ~
                  location: ~
              - Call:
                  id: a
                  typing: ~
                  location: ~
            typing: ~
            location: ~
        location: ~
    returned:
      - Float
      - Call:
          id: result
          typing: ~
          location: ~
    location: ~
nodes:
  - id: integrate
    is_component: false
    inputs:
      - - x
        - Float
      - - dt
        - Float
    equations:
      - - prev_i
        - scope: Local
          id: prev_i
          signal_type: Float
          expression:
            FollowedBy:
              constant:
                Float: 0
              expression:
                SignalCall:
                  id: i
                  typing: ~
                  location: ~
              typing: ~
              location: ~
          location: ~
      - - i
        - scope: Output
          id: i
          signal_type: Float
          expression:
            MapApplication:
              function_expression:
                Call:
                  id: min
                  typing: ~
                  location: ~
              inputs:
                - MapApplication:
                    function_expression:
                      Call:
                        id: " + "
                        typing: ~
                        location: ~
                    inputs:
                      - SignalCall:
                          id: prev_i
                          typing: ~
                          location: ~
                      - MapApplication:
                          function_expression:
                            Call:
                              id: " * "
                              typing: ~
                              location: ~
                          inputs:
                            - SignalCall:
                                id: x
                                typing: ~
                                location: ~
                            - SignalCall:
                                id: dt
                                typing: ~
                                location: ~
                          typing: ~
                          location: ~
                    typing: ~
                    location: ~
                - SignalCall:
                    id: MAX_INTEGRALE
                    typing: ~
                    location: ~
              typing: ~
              location: ~
          location: ~
      - - MAX_INTEGRALE
        - scope: Local
          id: MAX_INTEGRALE
          signal_type: Float
          expression:
            Constant:
              constant:
                Float: 1000
              typing: ~
              location: ~
          location: ~
    location: ~
  - id: derive
    is_component: false
    inputs:
      - - x
        - Float
      - - dt
        - Float
    equations:
      - - d
        - scope: Output
          id: d
          signal_type: Float
          expression:
            MapApplication:
              function_expression:
                Call:
                  id: " / "
                  typing: ~
                  location: ~
              inputs:
                - MapApplication:
                    function_expression:
                      Call:
                        id: (_)
                        typing: ~
                        location: ~
                    inputs:
                      - MapApplication:
                          function_expression:
                            Call:
                              id: " - "
                              typing: ~
                              location: ~
                          inputs:
                            - SignalCall:
                                id: x
                                typing: ~
                                location: ~
                            - SignalCall:
                                id: prev_x
                                typing: ~
                                location: ~
                          typing: ~
                          location: ~
                    typing: ~
                    location: ~
                - SignalCall:
                    id: dt
                    typing: ~
                    location: ~
              typing: ~
              location: ~
          location: ~
      - - prev_x
        - scope: Local
          id: prev_x
          signal_type: Float
          expression:
            FollowedBy:
              constant:
                Float: 0
              expression:
                SignalCall:
                  id: x
                  typing: ~
                  location: ~
              typing: ~
              location: ~
          location: ~
    location: ~
component:
  id: pid
  is_component: true
  inputs:
    - - v_c
      - Float
    - - v
      - Float
    - - dt
      - Float
  equations:
    - - gain
      - scope: Local
        id: gain
        signal_type:
          NotDefinedYet: GainPID
        expression:
          Structure:
            name: GainPID
            fields:
              - - k_p
                - Constant:
                    constant:
                      Float: 0.2
                    typing: ~
                    location: ~
              - - k_i
                - Constant:
                    constant:
                      Float: 1.5
                    typing: ~
                    location: ~
              - - k_d
                - Constant:
                    constant:
                      Float: 6
                    typing: ~
                    location: ~
            typing: ~
            location: ~
        location: ~
    - - u
      - scope: Output
        id: u
        signal_type: Float
        expression:
          Match:
            expression:
              SignalCall:
                id: gain
                typing: ~
                location: ~
            arms:
              - - Structure:
                    name: GainPID
                    fields:
                      - - k_p
                        - Identifier:
                            name: k_p
                            location: ~
                      - - k_i
                        - Identifier:
                            name: k_i
                            location: ~
                      - - k_d
                        - Identifier:
                            name: k_d
                            location: ~
                    location: ~
                - ~
                - MapApplication:
                    function_expression:
                      Call:
                        id: " + "
                        typing: ~
                        location: ~
                    inputs:
                      - MapApplication:
                          function_expression:
                            Call:
                              id: " + "
                              typing: ~
                              location: ~
                          inputs:
                            - MapApplication:
                                function_expression:
                                  Call:
                                    id: " * "
                                    typing: ~
                                    location: ~
                                inputs:
                                  - SignalCall:
                                      id: k_p
                                      typing: ~
                                      location: ~
                                  - SignalCall:
                                      id: e
                                      typing: ~
                                      location: ~
                                typing: ~
                                location: ~
                            - MapApplication:
                                function_expression:
                                  Call:
                                    id: " * "
                                    typing: ~
                                    location: ~
                                inputs:
                                  - SignalCall:
                                      id: k_i
                                      typing: ~
                                      location: ~
                                  - SignalCall:
                                      id: e_i
                                      typing: ~
                                      location: ~
                                typing: ~
                                location: ~
                          typing: ~
                          location: ~
                      - MapApplication:
                          function_expression:
                            Call:
                              id: " * "
                              typing: ~
                              location: ~
                          inputs:
                            - SignalCall:
                                id: k_d
                                typing: ~
                                location: ~
                            - SignalCall:
                                id: e_d
                                typing: ~
                                location: ~
                          typing: ~
                          location: ~
                    typing: ~
                    location: ~
            typing: ~
            location: ~
        location: ~
    - - e
      - scope: Local
        id: e
        signal_type: Float
        expression:
          MapApplication:
            function_expression:
              Call:
                id: " - "
                typing: ~
                location: ~
            inputs:
              - SignalCall:
                  id: v_c
                  typing: ~
                  location: ~
              - SignalCall:
                  id: v
                  typing: ~
                  location: ~
            typing: ~
            location: ~
        location: ~
    - - e_i
      - scope: Local
        id: e_i
        signal_type: Float
        expression:
          NodeApplication:
            node: integrate
            inputs:
              - SignalCall:
                  id: e
                  typing: ~
                  location: ~
              - SignalCall:
                  id: dt
                  typing: ~
                  location: ~
            signal: i
            typing: ~
            location: ~
        location: ~
    - - e_d
      - scope: Local
        id: e_d
        signal_type: Float
        expression:
          NodeApplication:
            node: derive
            inputs:
              - SignalCall:
                  id: e
                  typing: ~
                  location: ~
              - SignalCall:
                  id: dt
                  typing: ~
                  location: ~
            signal: d
            typing: ~
            location: ~
        location: ~
  location: ~
location: ~

